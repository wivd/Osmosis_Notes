# HTTP请求流程：

互联网传统的C/S框架

现在主流B/S架构——浏览器/服务器结构。

基于应用层的http协议。

## HTTP协议解析

​	HTTP(hyper Text Transfer Protocol)超文本传输协议，是一种详细规定了浏览器和万维网服务器之间互相通信的规则，它是万维网交换的基础，它允许将HTML（超文本标记语言）文档从web服务器传送到web浏览器。

## 发起HTTP请求

如何发起一个http请求？

在浏览器地址栏中输入一个url，并按回车键后就发起了这个HTTP请求，很快就会看到这个请求的返回结果。

URL(统一资源定位符)也被称为网页地址，是互联网标准的地址。

协议：//服务器IP[:端口]/路径/[?查询]

列如:http://www.baidu.com/post/http.html

除了借助浏览器来进行发起一次http请求，windows可以使用curl.exe工具来进发起请求。

## HTTP协议详解

htpp协议目前最新的版本是1.1，http是一种无状态的协议。

![](http://ww1.sinaimg.cn/large/007bHQE8gy1g671venx1oj30q80h0wk6.jpg)

无状态是指web浏览器与web服务器之间不需要建立持久的连接，这意味着当一个客户端向服务器发出请求，然后web服务器返回响应（Response），连接就被关闭了，在服务器端不保留连续的有关信息。

也就是说，htpp请求只能由客户端发起，而服务器不能主动向客户端发送数据。

HTTP遵循请求（Request）/应答（Response）模型，web浏览器向web服务器发送请求时，web服务器处理请求并返回适当的应答。

## HTTP请求与响应

### 1.http请求

HTTP请求包括三部分，分别是请求行（请求方法），请求头（消息报头）和请求正文。

![](http://ww1.sinaimg.cn/large/007bHQE8gy1g672jwknefj30ul07tjsd.jpg)

http请求行的第一行即为请求行，请求行由三部分组成，该行的第一·部分说明了该请求是post请求；

该行第二部分是一个斜杠（/wp-login.php）用来说明请求的是该域名根目录下的wp-login.php；该行的最后一部分说明使用的是HTTP 1.1版本。

第二行至空白行为HTTP中的请求头（也被称为消息头）。其中，HOST代表请求的主机地址，user-agent代表浏览器的标识，请求头由客户端自行设定。

http请求的最后一行为请求正文，请求正文是可选的。

### 2.http响应

与http请求对应的是HTTP响应也由三部分组成，分别是响应行，响应头（消息报头）和响应正文（消息主题）

![](http://ww1.sinaimg.cn/large/007bHQE8gy1g672raeu29j30vs0ly0w0.jpg)

HTTP响应的第一行为响应行，其中有HTTP版本（HTTP/1.1），状态码（200）以及消息ok

第二行至末尾空白行为响应头，由服务器向客户端发送。

消息报头之后是响应正文，是服务器向客户端发送的HTML数据。



### HTTP请求方法

常见的GET,POST。

GET

GET方法用于获取请求页面的指定信息（以实体的格式），如果请求资源为动态脚本，那么返回文本是web容器解析后的HTML源代码，而不是源文件。

HEAD

head方法除了服务器不能响应里返回消息主体外，其他都与GET方法相同，此方法经常被用来测试超文本链接的有效性，可访问性和最近的改。攻击者编写扫描工具时，就常用此方法，因为只测试资源是否存在，而不用返回消息的主题，所有速度一定是最快的，

POST

psot方法也与GET方法相似，但最大的区别在于，GET方法没有请求内容，而post是有请求内容的。post请求最多用于向服务器发送大量的数据，GET虽然也能发送数据，但是有大小长度限制，并且GET请求会将发送的数据显示在浏览器端，而post则不会，所以安全性相对来说高一点。

PUT

PUT方法用于请求服务器把请求中的实体存储在请求资源下，如果请求资源已在服务器中存在，那么将会用此请求中的数据替换原先的数据，作为指定资源的最新修改版。如果请求指定的资源不存在，将会创建这个资源，且数据位请求正文。

建议关闭此方法，因为它会位服务器建文件，属于危险的方法之一。

DELETE

delete方法用于请求源服务器删除请求的指定资源，服务器一般都会关闭此方法，因为客户端可以进行删除文件操作，属于危险方法之一。

TRACE

trace 方法被用于激发一个远程的应用层的请求消息回路，也就是说，回显服务器收到的请求。

CONNECT

HTTP 1.1 协议规范保留了connect方法，此方法是为了用于能动态切换到隧道模式。

OPTIONS

options 方法是用于请求获得由url标识的资源在请求/响应的通信过程中可以使用的功能选项，通过这个方法，客户端可以在采取具体资源请求之前，决定对该资源采取何种必要措施。

## HTTP状态码

1XX：信息提示，表示请求已被成功接受，继续处理。其范围为100~101.

2XX：成功，服务器成功地处理了请求。其范围为200~206

3XX：重定向，重定向状态码用于告诉浏览器客户端，它们访问的资源已被移动，并告诉客户端新的资源地址位置。这时，浏览器将重新对新资源发送请求。其范围为：300~305

4xx：客户端错误状态码，有时客户端会发送一些服务器无法处理的东西，比如格式错误请求，或者最常见的是，请求一个不存在的URL，其范围为：400~415

5xx：有时候客户端发送了一条有效请求，但web服务器自身却出错了，可能是web服务器运行出错了，或者网站都挂了，5xx就是用来描述服务器内部错误的，其范围为500~505.

常见的状态码描述：

200：客户端请求成功，是最常见的状态。

302：重定向

404：请求资源不存在，是最常见的状态。

400：客户端请求有语法错误，不能被服务器所理解。

401:请求未径授权。

403：服务器收到请求，但是拒绝提供服务。

500：服务器内部错误，是最常见的状态。

503：服务器当前不能处理客户端的请求，一段时间后可能恢复正常。

## HTTP消息

HTTP 消息又称为HTTP 头（HTTP header）,由四部分组成，分别是请求头，响应头，普通头和实体头。

1>请求头

请求头只出现在HTTP请求中，请求报头允许客户端向服务器传递请求的附加信息和客户端自身的信息。

1.Host

Host 请求报头域主要用于指定被请求资源的Internet 主机和端口号，如之前的抓包内容。

2.User-Agent

User-Agent 请求报头域允许客户端将它的操作系统，浏览器和其它属性告诉服务器。登录一些网站时，很多时候都可以见到显示我们的浏览器，系统信息，这些都是此头的作用。

3.Referer

Referer包含一个URL，代表当前访问URL的上一个URL，也就说，用户是从什么地方来到本页面。如：Referer：www.xxxser.com/login.php 代表用户从login.php来到当前页面。

4.Cookie

Cookie是非常重要的请求头，它是一段文本，常用来表示请求者身份等。在后门将会详细讲述Cookie。

5.Range

Range可以请求实体的部分内容，多线程下载一定会用到此请求头。

6.x-forward-for

X-forward-for 即XXF头，它代表请求端的IP，可以有多个，中间以逗号隔开。

7.Accept

Accept请求报头域用于指定客户端接收那些MIME类型的信息，如Accept: test/html 表明客户端希望接收HTML文本。

8.Accept-Charset

Accept-Charset请求报头域用于指定客户端接收的字符集。列如：Accept-Charset：iso-8859-1，gb2312.如果在请求消息中没有设置这个域，默认是任何字符集都可以接收。

## 2>响应头

响应头是服务器根据请求向客户端发送的HTTP头。

1.server

服务器所使用的web服务器名称，如Server:Apache/1.3.6,攻击者通过查看此头，可以探测web服务器名称。所以，建议在服务器端进行修改此头的信息。

2.Set-Cookie

向客户端设置Cookie，通过查看此头，可以清楚地看到服务器向客户端发送的cookie信息。

3.Last-Modified 

服务器通过这个头告诉浏览器，资源的最后修改时间。

4.Location

服务器通过这个头告诉浏览器去访问那个页面，浏览器接收到这个请求之后，通常会立刻访问Location头所指向的页面。这个头通常配合302状态码使用。

5.Refresh

服务器通过Refresh头告诉浏览器定时刷新浏览器。

3>普通头

在普通报头中，有少数报头域用于所有的请求和响应消息，但并不用于被传输的实体，只用于传输的消息。

4>实体头

请求和响应消息都可以传送一个实体头。实体头定义了关于实体正文和请求所标识的资源的元信息。元信息也就是实体内容的属性，包括实体信息类型，长度，压缩方法，最后一次修改时间 常见的实体如下

1.Content-Type

Content-Type实体头用于向接收方指示实体的介质类型。

2.Content-Encoding

Content-Encoding 头被用作媒体类型的修饰符，它的值指示了已经被应用到实体正文的附加内容编码，因而要获得Content-Type 报头域中所引用的媒体类型，必须采用相应的解码机制。

3.Content-Length

Content-Length实体报头用于指示资源的最后修改日期和时间。

4.Last-Modified

Last-Modified 实体报头用于指示资源的最后修改日期和时间。







